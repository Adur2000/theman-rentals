<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Map container -->
<div id="map" style="height: 300px; margin-bottom: 10px; border-radius: 6px;"></div>
<button type="button" onclick="clearMarker()" style="margin-bottom: 20px;">üßπ Clear Marker</button>

<!-- Form -->
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Add House</button>
</form>
<script>
    var map = L.map('map').setView([-1.2921, 36.8219], 10); // Default: Nairobi

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // üñºÔ∏è Custom icon
    var customIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/854/854878.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
    });

    var marker;

    // üìç Use current location
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            map.setView([lat, lng], 14);
        });
    }

    // üñ±Ô∏è Click to place marker
    map.on('click', function(e) {
        var lat = e.latlng.lat.toFixed(6);
        var lng = e.latlng.lng.toFixed(6);

        if (marker) {
            marker.setLatLng(e.latlng);
        } else {
            marker = L.marker(e.latlng, { icon: customIcon }).addTo(map);
        }

        document.getElementById('id_latitude').value = lat;
        document.getElementById('id_longitude').value = lng;
    });

    // üßπ Clear marker
    function clearMarker() {
        if (marker) {
            map.removeLayer(marker);
            marker = null;
            document.getElementById('id_latitude').value = '';
            document.getElementById('id_longitude').value = '';
        }
    }
</script>